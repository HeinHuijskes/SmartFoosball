<!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/styles.css">
    <title> THE SMART FOOSBALL TABLE</title>
    <link href='https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,200;1,14..32,200&display=swap' rel='stylesheet'>
    <style>
        body { font-family: 'Inter'; font-weight: 200; font-size: 22px;
        margin: 0; padding: 0;}
        h1 { font-weight: 200; text-align: center}
        p {text-align: center}
        img {max-width: 100%; max-height: 100%}
        .center_child {vertical-align: middle;}
        #but_new_game:hover { color: grey}
    </style>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script>
        //function to display text if goal is scored
        // function score(){
        //     document.getElementById("marquee_outer").style.background = "lightgrey";
        //     document.getElementById("marquee").innerText = "GOAL !  GOAL!  GOAL !  GOAL !  GOAL !  GOAL !  GOAL !  GOAL !  GOAL!  GOAL !  GOAL!  GOAL !  GOAL !  GOAL !  GOAL !  GOAL !  GOAL !  GOAL!GOAL !  GOAL!  GOAL !  GOAL !  GOAL !  GOAL !  GOAL !  GOAL !  GOAL!  GOAL !  GOAL!  GOAL !  GOAL !  GOAL !  GOAL !  GOAL !  GOAL !  GOAL!  GOAL !  GOAL!  GOAL !  GOAL !  GOAL !  GOAL !  GOAL !  GOAL !  GOAL!"
        //     setTimeout(function() {
        //     document.getElementById("marquee_outer").style.background = "transparent";
        //     document.getElementById("marquee").innerText = " "
        //      }, 5000);
        //
        // }

        function score(){
            document.getElementById("marquee_outer").style.background = "lightgrey";
            document.getElementById("marquee").innerText = "GOAL !  GOAL !  GOAL !";
            setTimeout(function() {
            document.getElementById("marquee").innerText = " "
             }, 1000);
            setTimeout(function() {
            document.getElementById("marquee").innerText = "GOAL !  GOAL !  GOAL ! "
             }, 2000);
            setTimeout(function() {
            document.getElementById("marquee").innerText = " "
             }, 3000);
            setTimeout(function() {
            document.getElementById("marquee").innerText = "GOAL !  GOAL !  GOAL !"
             }, 4000);
            setTimeout(function() {
            document.getElementById("marquee_outer").style.background = "transparent";
            document.getElementById("marquee").innerText = " ";
             }, 5100);

        }
        // to update score
        function fetchScore() {
            var oldscore = document.getElementById('score').innerText;
            var o_scores= oldscore.split(' - ')
            var oldscoreL = parseInt(o_scores[0]);
            var oldscoreR = parseInt(o_scores[1]);
            $.getJSON("/update_score", function(data) {
                $('#score').html('<p style="text-align: left; font-weight: 400">' + data.scoreL + ' - ' + data.scoreR + '</p>');
            var newscoreL= data.scoreL;
            var newscoreR = data.scoreR;
            if(oldscoreL != newscoreL)
                score();
            if(oldscoreR != newscoreR)
                score();
            });


        }
        // Fetch the score every 5 seconds
        setInterval(fetchScore, 500);
        // to update speed

        //function when new game button is pressed
        function newgame(){
            document.getElementById("but_new_game").innerHTML = "new game starting ..."; //TODO change
            $.getJSON("/new_game", function(data) {
                $('#but_new_game').html(data.dtext);
            });

        }
    </script>
</head>
<body>
<div style="position: fixed; margin-left: 10%; z-index: 2">
    <a style="color: black; background-color: transparent; text-decoration: transparent;" href="index.html"> <p>&larr;</p></a>
</div>

<!--<div id="marquee_outer" style="background-color: lightgrey;z-index:3;position:fixed;margin-top:2%;width:100%;height:150px;display:flex;align-items:center;">-->
<!--    <marquee id="marquee" style="font-weight:300;font-size:50px;" scrollamount="15">GOAL ! </marquee>-->
<!--</div>-->

<div id="marquee_outer" style="background-color: transparent;z-index:3;position:fixed;margin-top:2%;width:100%;height:150px;display:flex;align-items:center;">
<!--    <marquee id="marquee" animation: marquee 10s linear infinite; style="font-weight:300;font-size:50px;" scrollamount="15"> </marquee>-->
    <p id="marquee" style="width:100%;font-weight:300;font-size:50px;text-align: center"> </p>
</div>

<div style="z-index: 1;background-color: rgba(255, 255, 255, 0.75);position: fixed;max-width: 100%; width: 100%; height: 150px; margin-top: 2%">
    <h1 style=" background-color: rgba(255, 255, 255, 0.5);padding: 20px;max-width: 100%; font-weight: 200; text-align: center">Live game</h1></div>
<div id="behind title" style="height: 170px"></div>


<div id="new_center" style="max-width: 100%; display: flex">
    <div class="center_child" style="width: 19%; padding: 3%;margin-top: 6%">
        <p id="but_new_game" onclick="newgame()">New game</p>
    </div>
    <div class="center_child" style="width: 49%">
        <p style="text-align: left;margin:3%">Camera feed</p>
        <div style="background-color: lightgray;padding: 20px; height: 400px; margin: auto; text-align: center;">
            <img src="{{ url_for('video_feed') }}" alt="Video Feed">
            <img src="{{ url_for('delayed_video_feed') }}" alt="Delayed Video Feed"></div>
    </div>
    <div class="center_child"style="width: 19%; padding: 3%;margin-top: 6%" >
         <p style="text-align: left">Match score </p>
            <p id="score" style="text-align: left; font-weight: 400;"> {{scoreL}} - {{scoreR}}</p>
         <p style="text-align: left">Maximum speed </p>
            <p id="speed" style="text-align: left; font-weight: 400;"> {{max_speed}}</p>
    </div>
</div>





<!--<div class="centerbox" style="margin: auto; max-width: 50%; margin-top: 25px; margin-left: 25%">-->
<!--    <div>-->
<!--    <p style="text-align: left;">Camera feed</p></div>-->
<!--    <div style="background-color: lightgray;padding: 20px; height: 400px; margin: auto; text-align: center;">-->
<!--        <img src="{{ url_for('video_feed') }}" alt="Video Feed">-->
<!--    </div>-->

    <!-- two div boxes that split the space under the live feed-->

<!--    <div style="background-color: transparent">-->
<!--        <div style="display: inline-block; background-color: transparent; width: 50%; margin-right: 0">-->
<!--            <p style="text-align: left">Match score </p>-->
<!--            <p id="score" style="text-align: left; font-weight: 400;"> {{scoreL}} - {{scoreR}}</p>-->

<!--    &lt;!&ndash;        <meta http-equiv="refresh" content="5">&ndash;&gt;-->

<!--        </div>-->
<!--        <div style="display: inline-block; width: 49%; margin-left: 0">-->
<!--            <p style="text-align: left">Maximum Speed </p>-->
<!--            <p id="speed" style="text-align: left; font-weight: 400;"> {{max_speed}}</p>-->
<!--        </div>-->
    </div>
    <div style="width: 50%">
    </div>
</div>
<div>

</div>
</body>
<script>
    function fetchSpeed() {
            $.getJSON("/update_speed", function(data) {
                $('#speed').html('<p style="text-align: left; font-weight: 400">' + data.max_speed+ '</p>');
            });
        }
        // Fetch the score every 5 seconds
        setInterval(fetchSpeed, 500);</script>
</html>